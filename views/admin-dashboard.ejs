<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body {
      margin: 0;
      font-family: Arial;
    }
    .container {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 220px;
      background: #1f2937;
      color: #fff;
      padding: 20px;
    }
    .sidebar a {
      display: block;
      color: #fff;
      text-decoration: none;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 4px;
    }
    .sidebar a.active,
    .sidebar a:hover {
      background: #374151;
    }
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
  </style>
</head>
<body>

<div class="container">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Admin Panel</h3>

    <a href="/admin/customers" class="<%= page === 'customers' ? 'active' : '' %>">
      Customers
    </a>

    <a href="/admin/subscriptions" class="<%= page === 'subscriptions' ? 'active' : '' %>">
      Subscriptions
    </a>

    <br>
    <a href="/admin/logout">Logout</a>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <% if (page === "customers") { %>
      <h2>Customers</h2>
      <table>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Contact</th>
          <th>Total Subs</th>
          <th>Active Subs</th>
        </tr>
        <% customers.forEach(c => { 
          const active = c.subscriptions.filter(s => s.status === "active").length;
        %>
          <tr>
            <td><%= c.name %></td>
            <td><%= c.email %></td>
            <td><%= c.contact || "-" %></td>
            <td><%= c.subscriptions.length %></td>
            <td><%= active %></td>
          </tr>
        <% }) %>
      </table>
    <% } %>

    <% if (page === "subscriptions") { %>
      <h2>Subscriptions</h2>
      <table>
        <tr>
          <th>Customer</th>
          <th>Product</th>
          <th>Frequency</th>
          <th>Status</th>
          <th>Amount</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
        <% subscriptions.forEach(s => { %>
          <tr>
  <td><%= s.customer.email %></td>
  <td><%= s.product %></td>
  <td><%= s.frequency %></td>
  <td><%= s.status %></td>
  <td>â‚¹<%= s.totalAmount %></td>
  <td><%= s.createdAt.toDateString() %></td>

  <td>
    <% if (s.status === "active") { %>
      <form method="POST" action="/admin/subscription/<%= s.id %>/action" style="display:inline;">
        <input type="hidden" name="action" value="stop">
        <button type="submit">Stop</button>
      </form>

      <form method="POST" action="/admin/subscription/<%= s.id %>/action" style="display:inline;">
        <input type="hidden" name="action" value="cancel">
        <button type="submit">Cancel</button>
      </form>

    <% } else if (s.status === "stopped") { %>
      <form method="POST" action="/admin/subscription/<%= s.id %>/action" style="display:inline;">
        <input type="hidden" name="action" value="resume">
        <button type="submit">Resume</button>
      </form>

      <form method="POST" action="/admin/subscription/<%= s.id %>/action" style="display:inline;">
        <input type="hidden" name="action" value="cancel">
        <button type="submit">Cancel</button>
      </form>

    <% } else { %>
      _
    <% } %>
  </td>
</tr>

        <% }) %>
      </table>
    <% } %>

  </div>
</div>

</body>
</html>
